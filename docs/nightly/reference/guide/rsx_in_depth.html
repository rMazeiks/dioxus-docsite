<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RSX in Depth</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../platforms/index.html"><strong aria-hidden="true">2.</strong> Platforms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../platforms/web.html"><strong aria-hidden="true">2.1.</strong> Web</a></li><li class="chapter-item expanded "><a href="../platforms/ssr.html"><strong aria-hidden="true">2.2.</strong> Server Side Rendering</a></li><li class="chapter-item expanded "><a href="../platforms/desktop.html"><strong aria-hidden="true">2.3.</strong> Desktop</a></li><li class="chapter-item expanded "><a href="../platforms/mobile.html"><strong aria-hidden="true">2.4.</strong> Mobile</a></li><li class="chapter-item expanded "><a href="../platforms/tui.html"><strong aria-hidden="true">2.5.</strong> TUI</a></li></ol></li><li class="chapter-item expanded "><a href="../guide/index.html"><strong aria-hidden="true">3.</strong> Advanced Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../guide/rsx_in_depth.html" class="active"><strong aria-hidden="true">3.1.</strong> RSX in Depth</a></li><li class="chapter-item expanded "><a href="../guide/custom_renderer.html"><strong aria-hidden="true">3.2.</strong> Custom Renderer</a></li><li class="chapter-item expanded "><a href="../guide/hot_reloading.html"><strong aria-hidden="true">3.3.</strong> Hot Reloading Rsx</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rsx-in-depth"><a class="header" href="#rsx-in-depth">RSX in Depth</a></h1>
<p>The RSX macro makes it very easy to assemble complex UIs with a very natural Rust syntax:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>rsx!(
    div {
        button {
            onclick: move |e| todos.write().new_todo(),
            &quot;Add todo&quot;
        }
        ul {
            class: &quot;todo-list&quot;,
            todos.iter().map(|(key, todo)| rsx!(
                li { 
                    class: &quot;beautiful-todo&quot;
                    key: &quot;f&quot;
                    h3 { &quot;{todo.title}&quot; }
                    p { &quot;{todo.contents}&quot;}
                }
            ))
        }
    }
)
<span class="boring">}
</span></code></pre></pre>
<p>In this section, we'll cover the <code>rsx!</code> macro in depth. If you prefer to learn through examples, the  <code>code reference</code> guide has plenty of examples on how to use <code>rsx!</code> effectively.</p>
<h3 id="element-structure"><a class="header" href="#element-structure">Element structure</a></h3>
<p>Attributes must come before  child elements</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>div {
    hidden: &quot;false&quot;,
    &quot;some text&quot;
    child {}
    Component {} // uppercase
    component() // lowercase is treated like a function call
    (0..10).map(|f| rsx!{ &quot;hi {f}&quot; }) // arbitrary rust expressions
}
<span class="boring">}
</span></code></pre></pre>
<p>Each element takes a comma-separated list of expressions to build the node. Roughly, here's how they work:</p>
<ul>
<li><code>name: value</code> sets a property on this element.</li>
<li><code>&quot;text&quot;</code> adds a new text element</li>
<li><code>tag {}</code> adds a new child element</li>
<li><code>CustomTag {}</code> adds a new child component</li>
<li><code>{expr}</code> pastes the <code>expr</code> tokens literally. They must be <code>IntoIterator&lt;T&gt; where T: IntoVnode</code> to work properly</li>
</ul>
<p>Commas are entirely optional, but might be useful to delineate between elements and attributes.</p>
<p>The <code>render</code> function provides an <strong>extremely efficient</strong> allocator for VNodes and text, so try not to use the <code>format!</code> macro in your components. Rust's default <code>ToString</code> methods pass through the global allocator, but all text in components is allocated inside a manually-managed Bump arena. To push you in the right direction, all text-based attributes take <code>std::fmt::Arguments</code> directly, so you'll want to reach for <code>format_args!</code> when the built-in <code>f-string</code> interpolation just doesn't cut it.</p>
<h3 id="ignoring-cxrender-with-rsxcx-"><a class="header" href="#ignoring-cxrender-with-rsxcx-">Ignoring <code>cx.render</code> with <code>rsx!(cx, ...)</code></a></h3>
<p>Sometimes, writing <code>cx.render</code> is a hassle. The `rsx! macro will accept any token followed by a comma as the target to call &quot;render&quot; on:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>cx.render(rsx!( div {} ))
// becomes
rsx!(cx, div {})
<span class="boring">}
</span></code></pre></pre>
<h3 id="conditional-rendering"><a class="header" href="#conditional-rendering">Conditional Rendering</a></h3>
<p>Sometimes, you might not want to render an element given a condition. The rsx! macro will accept any tokens directly contained with curly braces, provided they resolve to a type that implements <code>IntoIterator&lt;VNode&gt;</code>. This lets us write any Rust expression that resolves to a VNode:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>rsx!({
    if enabled {
        rsx!(cx, div {&quot;enabled&quot;})
    } else {
        rsx!(cx, li {&quot;disabled&quot;})
    }
})
<span class="boring">}
</span></code></pre></pre>
<p>A convenient way of hiding/showing an element is returning an <code>Option&lt;VNode&gt;</code>. When combined with <code>and_then</code>, we can succinctly control the display state given some boolean:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>rsx!({
    a.and_then(rsx!(div {&quot;enabled&quot;}))
})
<span class="boring">}
</span></code></pre></pre>
<p>It's important to note that the expression <code>rsx!()</code> is typically lazy - this expression must be <em>rendered</em> to produce a VNode. When using match statements, we must render every arm as to avoid the <code>no two closures are identical</code> rule that Rust imposes:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// this will not compile!
match case {
    true =&gt; rsx!(div {}),
    false =&gt; rsx!(div {})
}

// the nodes must be rendered first
match case {
    true =&gt; rsx!(cx, div {}),
    false =&gt; rsx!(cx, div {})
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="lists"><a class="header" href="#lists">Lists</a></h3>
<p>Again, because anything that implements <code>IntoIterator&lt;VNode&gt;</code> is valid, we can use lists directly in our <code>rsx!</code>:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let items = vec![&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];

cx.render(rsx!{
    ul {
        {items.iter().map(|f| rsx!(li { &quot;a&quot; }))}
    }
})
<span class="boring">}
</span></code></pre></pre>
<p>Sometimes, it makes sense to render VNodes into a list:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut items = vec![];

for _ in 0..5 {
    items.push(rsx!(cx, li {} ))
}

rsx!(cx, {items} )
<span class="boring">}
</span></code></pre></pre>
<h4 id="lists-and-keys"><a class="header" href="#lists-and-keys">Lists and Keys</a></h4>
<p>When rendering the VirtualDom to the screen, Dioxus needs to know which elements have been added and which have been removed. These changes are determined through a process called &quot;diffing&quot; - an old set of elements is compared to a new set of elements. If an element is removed, then it won't show up in the new elements, and Dioxus knows to remove it.</p>
<p>However, with lists, Dioxus does not exactly know how to determine which elements have been added or removed if the order changes or if an element is added or removed from the middle of the list.</p>
<p>In these cases, it is vitally important to specify a &quot;key&quot; alongside the element. Keys should be persistent between renders.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn render_list(cx: Scope, items: HashMap&lt;String, Todo&gt;) -&gt; DomTree {
    rsx!(cx, ul {
        {items.iter().map(|key, item| {
            li {
                key: key,
                h2 { &quot;{todo.title}&quot; }
                p { &quot;{todo.contents}&quot; }
            }
        })}
    })
}
<span class="boring">}
</span></code></pre></pre>
<p>There have been many guides made for keys in React, so we recommend reading up to understand their importance:</p>
<ul>
<li><a href="https://reactjs.org/docs/lists-and-keys.html">React guide on keys</a></li>
<li><a href="https://kentcdodds.com/blog/understanding-reacts-key-prop">Importance of keys (Medium)</a></li>
</ul>
<h3 id="complete-reference"><a class="header" href="#complete-reference">Complete Reference</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let text = &quot;example&quot;;

cx.render(rsx!{
    div {
        h1 { &quot;Example&quot; },

        {title}

        // fstring interpolation
        &quot;{text}&quot;

        p {
            // Attributes
            tag: &quot;type&quot;,

            // Anything that implements display can be an attribute
            abc: 123,
            
            enabled: true,

            // attributes also supports interpolation
            // `class` is not a restricted keyword unlike JS and ClassName
            class: &quot;big small wide short {text}&quot;,

            class: format_args!(&quot;attributes take fmt::Arguments. {}&quot;, 99),

            tag: {&quot;these tokens are placed directly&quot;}

            // Children
            a { &quot;abcder&quot; },

            // Children with attributes
            h2 { &quot;hello&quot;, class: &quot;abc-123&quot; },

            // Child components
            CustomComponent { a: 123, b: 456, key: &quot;1&quot; },

            // Child components with paths
            crate::components::CustomComponent { a: 123, b: 456, key: &quot;1&quot; },

            // Iterators
            { (0..3).map(|i| rsx!( h1 {&quot;{:i}&quot;} )) },

            // More rsx!, or even html!
            { rsx! { div { } } },
            { html! { &lt;div&gt; &lt;/div&gt; } },

            // Matching
            // Requires rendering the nodes first.
            // rsx! is lazy, and the underlying closures cannot have the same type
            // Rendering produces the VNode type
            {match rand::gen_range::&lt;i32&gt;(1..3) {
                1 =&gt; rsx!(cx, h1 { &quot;big&quot; })
                2 =&gt; rsx!(cx, h2 { &quot;medium&quot; })
                _ =&gt; rsx!(cx, h3 { &quot;small&quot; })
            }}

            // Optionals
            {true.and_then(|f| rsx!( h1 {&quot;Conditional Rendering&quot;} ))}

            // Child nodes
            {cx.props.children}

            // Any expression that is `IntoVNode`
            {expr}
        }
    }
})
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../guide/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../guide/custom_renderer.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../guide/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../guide/custom_renderer.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
